<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
  <title>音乐台</title>
  <link rel="shortcut icon" href="https://wang64.cn/static/favicon.ico" />
  <link href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css">
  <!-- 垂直居中参考 https://www.cnblogs.com/yugege/p/5246652.html -->
  <!-- APlayer源码 https://github.com/MoePlayer/APlayer -->
  <!-- 搜索API https://github.com/metowolf/Meting https://github.com/metowolf/MetingJS -->
  <!-- wenkmPlayer Start -->
  <link rel="stylesheet" type="text/css" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://mark.wang64.cn/assets/wenkmPlayer/css/player.css?v=0914">
  <!-- wenkmPlayer End -->
  <style>
    @font-face {
      font-family: 'Monoton';
      font-style: normal;
      font-weight: 400;
      src: local('Monoton'), local('Monoton-Regular'), url(https://text.wang64.cn/html5-shine-text/css/font/01.woff) format('woff');
    }
    @font-face {
      font-family: 'Pacifico';
      font-style: normal;
      font-weight: 400;
      src: local('Pacifico Regular'), local('Pacifico-Regular'), url(https://text.wang64.cn/html5-shine-text/css/font/03.woff) format('woff');
    }
    @font-face {
      font-family: 'Audiowide';
      font-style: normal;
      font-weight: 400;
      src: local('Audiowide'), local('Audiowide-Regular'), url(https://text.wang64.cn/html5-shine-text/css/font/05.woff) format('woff');
    }
    @font-face {
      font-family: 'Vampiro One';
      font-style: normal;
      font-weight: 400;
      src: local('Vampiro One'), local('VampiroOne-Regular'), url(https://text.wang64.cn/html5-shine-text/css/font/06.woff) format('woff');
    }
    html, body {
        width: 100%;
        height: 100%;
        margin: 0; 
        padding: 0;
    }
    /* body {
      background-color: #2e2e31;
      隐藏滚动条
      overflow: hidden;
    } */
    #bg {
      background-image: url(https://wang926454.gitee.io/reader/Image/CameraThumb/IMG_20171021_172112.jpg);
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      min-width: 1000px;
      z-index: -10;
      zoom: 1;
      /* opacity: 0.75;
      filter: alpha(opacity = 75); */
      background-color: #000;
      background-repeat: no-repeat;
      background-size: cover;
      -webkit-background-size: cover;
      -o-background-size: cover;
      background-position: center 0;
    }
    #text {
      text-align: center;
      font-size: 2em;
      color: #FF1177;
      font-family: Monoton;
    }
    .middle {
        position: absolute;
        top: 45%;
        left: 0;
        right: 0;
        z-index: 2;
        width: 100%;
        /* min-height: 260px; */
        padding-top: 5px;
        -webkit-transform: translateY(-50%);
        -moz-transform: translateY(-50%);
        -ms-transform: translateY(-50%);
        -o-transform: translateY(-50%);
        transform: translateY(-50%);
    }
    .aplayer-wrap {
      max-width: 700px;
      margin: 20px auto;
    }
    
  </style>
  <script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script>
  <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
  <script src="https://cdn.staticfile.org/layer/2.3/layer.js"></script>
</head>

<body>
  <!--背景图片-->
  <div id="bg"></div>

  <div class="middle">
    <div class="col-md-12 col-sm-12 col-xs-12">
      <div style="margin: 0px auto; display: table;">
        <a href="https://www.fczbl.vip/musicplayer" target="_blank">
          <p id="text">MyMusic</p>
        </a>
      </div>
    </div>

    <div class="col-md-12 col-sm-12 col-xs-12" style="margin-top: 10px;">
      <div style="margin: 0px auto; display: table;">
        <div class="col-md-6 col-sm-6 col-xs-6" style="margin-left: 8px;">
          <select id="serachType" class="form-control">
            <option value="netease">网易云音乐</option>
            <option value="kugou">酷狗音乐</option>
            <option value="tencent">QQ音乐</option>
            <option value="xiami">虾米音乐</option>
            <option value="baidu">百度音乐</option>
          </select>
        </div>
        <div class="col-md-6 col-sm-6 col-xs-6" style="margin-left: -16px;">
          <input id="serachText" type="text" class="form-control" placeholder="请输入关键字">
        </div>
      </div>
    </div>

    <div class="col-md-12 col-sm-12 col-xs-12" style="margin-top: 10px;">
      <div style="margin: 0px auto; display: table;">
        <a href="https://wang64.cn" target="_blank"><button type="button" class="btn btn-primary">主页</button></a><span onclick="now()"> | </span>
        <button id="listBtn" type="button" class="btn btn-warning active" onclick="list()">网易云音乐热歌榜(周四更新)</button> | 
        <button id="serachBtn" type="button" class="btn btn-info active" onclick="search(this)">搜索</button>
      </div>
    </div>

    <div id="aplayerDiv1" name="aplayerDiv" class="col-md-12 col-sm-12 col-xs-12">
      <div class="aplayer-wrap">
        <div id="aplayer1"></div>
      </div>
    </div>

    <div id="aplayerDiv2" name="aplayerDiv" class="col-md-12 col-sm-12 col-xs-12">
      <div class="aplayer-wrap">
        <div id="aplayer2"></div>
      </div>
    </div>

    <div id="aplayerDiv3" name="aplayerDiv" class="col-md-12 col-sm-12 col-xs-12">
      <div class="aplayer-wrap">
        <div id="aplayer3"></div>
      </div>
    </div>

    <div id="aplayerDiv4" name="aplayerDiv" class="col-md-12 col-sm-12 col-xs-12">
      <div class="aplayer-wrap">
        <div id="aplayer4"></div>
      </div>
    </div>

    <div class="col-md-12 col-sm-12 col-xs-12">
      <div style="margin: 0px auto; display: table;">
        <div class="btn-group">
          <button id="loveBtn" type="button" class="btn btn-danger" onclick="love()">我的音乐列表</button>
          <a href="https://music.163.com/#/playlist?id=2553791717" target="_blank"><button type="button" class="btn btn-success">歌单地址</button></a>
        </div> |
        <button id="loveBtn" type="button" class="btn btn-danger active" onclick="late()">最近喜欢听的歌</button>
      </div>
    </div>
  </div>

  <!-- wenkmPlayer Start -->
  <div id="wangPlayer" style="display: none;"></div>
  <!-- <script type="text/javascript" src="https://wang926454.gitee.io/reader/JS/aplist.js"></script> -->
  <script type="text/javascript" src="JS/aplist.js"></script>
  <script src="https://mark.wang64.cn/assets/wenkmPlayer/js/mousewheel.js" type="text/javascript"></script>
  <script src="https://mark.wang64.cn/assets/wenkmPlayer/js/scrollbar.js" type="text/javascript"></script>
  <!-- <script src="https://mark.wang64.cn/assets/wenkmPlayer/js/player.js?v=123" type="text/javascript"></script> -->
  <!-- wenkmPlayer End -->

  <script>
    // PC端返回false
    function isMobile() {
      var viewType = navigator.userAgent.toLowerCase();
      // console.log(viewType);
      return viewType.match(/(phone|pad|pod|midp|iphone|ipod|iphone os|ios|ipad|android|mobile|blackberry|iemobile|mqqbrowser|juc|rv:1.2.3.4|ucweb|fennec|wosbrowser|browserng|webos|symbian|windows ce|windows mobile|windows phone)/i);
    }

    if (isMobile()) {
      // 设置距离高度
      var middleArray = document.getElementsByClassName("middle");
      middleArray[0].style.top = "50%";
    } else {
      // 隐藏滚动条
      document.body.style.overflow = 'hidden';
      try {
        // 加载wenkmPlayerc
        $.ajax({ url: 'https://mark.wang64.cn/assets/wenkmPlayer/js/player.js?v=123', dataType: "script", cache: true, async: false });
      } catch (err) {
        console.log('[Error] JQuery is not defined.')
      } finally {
        $(window).load(function() {
          wenkmTips.show('欢迎访问我的音乐台');
          // 显示歌词和提示
          document.getElementById('wenkmPlayer').style.display = 'none';
          document.getElementById('wangPlayer').style.display = 'inline';
        });
      }
    }
  </script>

  <script>
    // 我的音乐列表
    const ap1 = new APlayer({
      container: document.getElementById('aplayer1'),
      lrcType: 3,
      order: 'random',
      theme: '#000000',
      audio: getLove()
    });

    // 网易云音乐热歌榜
    const ap2 = new APlayer({
      container: document.getElementById('aplayer2'),
      lrcType: 3,
      theme: '#000000',
    });

    // 最近喜欢听的歌
    const ap3 = new APlayer({
      container: document.getElementById('aplayer3'),
      lrcType: 3,
      order: 'random',
      theme: '#000000',
    });

    // 搜索
    const ap4 = new APlayer({
      container: document.getElementById('aplayer4'),
      lrcType: 3,
      theme: '#000000',
    });

    var aplist1 = ap1.list.audios;
    var aplist2 = [];
    var aplist3 = [];
    var aplist4 = [];

    function lrcCurrentAp1() {
      var timeNow = Math.round(ap1.audio.currentTime);
      if ($.inArray(timeNow, lrcTimeLine) > 0) {
        var $lineNow = $('.wenkmLrc' + timeNow);
        if (!$lineNow.hasClass(cur)) {
          $lineNow.addClass(cur).siblings().removeClass(cur);
          $('#wenkmLrc').animate({
            scrollTop: lrcHeight * $lineNow.index()
          })
        }
      } else {
        lrcCont = '';
      }
    }

    function lrcCurrentAp2() {
      var timeNow = Math.round(ap2.audio.currentTime);
      if ($.inArray(timeNow, lrcTimeLine) > 0) {
        var $lineNow = $('.wenkmLrc' + timeNow);
        if (!$lineNow.hasClass(cur)) {
          $lineNow.addClass(cur).siblings().removeClass(cur);
          $('#wenkmLrc').animate({
            scrollTop: lrcHeight * $lineNow.index()
          })
        }
      } else {
        lrcCont = '';
      }
    }

    function lrcCurrentAp3() {
      var timeNow = Math.round(ap3.audio.currentTime);
      if ($.inArray(timeNow, lrcTimeLine) > 0) {
        var $lineNow = $('.wenkmLrc' + timeNow);
        if (!$lineNow.hasClass(cur)) {
          $lineNow.addClass(cur).siblings().removeClass(cur);
          $('#wenkmLrc').animate({
            scrollTop: lrcHeight * $lineNow.index()
          })
        }
      } else {
        lrcCont = '';
      }
    }

    function lrcCurrentAp4() {
      var timeNow = Math.round(ap4.audio.currentTime);
      if ($.inArray(timeNow, lrcTimeLine) > 0) {
        var $lineNow = $('.wenkmLrc' + timeNow);
        if (!$lineNow.hasClass(cur)) {
          $lineNow.addClass(cur).siblings().removeClass(cur);
          $('#wenkmLrc').animate({
            scrollTop: lrcHeight * $lineNow.index()
          })
        }
      } else {
        lrcCont = '';
      }
    }

    function lrcLoad(lrcTempUrl, typeNo) {
      wenkmLrc.lrc.hide();
      hasLrc = false;
      hasKsc = false;
      $('#wenkmLrc, #wenkmKsc').html('');
      setTimeout(function () {
        if (hasgeci) {
          $songFrom3.html('<i class="fa fa-check-circle"></i> 歌词' + songFrom33);
        } else {
          $songFrom3.html('<i class="fa fa-times-circle"></i> 歌词' + songFrom33);
        };
        $(".switch-down").css("right", "65px");
        $(".switch-default").css("right", "95px");
        if (hasdefault) {
          setTimeout(function () {
            $(".switch-ksclrc").show()
          }, 300);
        } else {
          $(".switch-ksclrc").show()
        }
        $.ajax({
          url: lrcTempUrl,
          success: function (lrctext) {
            if (typeof (lrctext) == 'undefined') {
              songFrom44 = ' - 暂无歌词!', $songFrom3.html('<i class="fa fa-times-circle"></i> 暂无歌词');
              $(".switch-ksclrc").hide();
              $(".switch-down").css("right", "35px");
              $(".switch-default").css("right", "65px");
            } else {
              if (lrctext.indexOf('[00') >= 0) {
                setTimeout(function () {
                  if (!$('#wenkmLrc').hasClass('hide')) {
                    songFrom44 = ' - Lrc歌词获取成功!'
                  } else {
                    songFrom44 = ' - Lrc歌词已关闭！'
                  };
                  hasLrc = true;
                  function formatTime(t) {
                    var sp = t.split(':'),
                      min = +sp[0],
                      sec = +sp[1].split('.')[0],
                      ksec = +sp[1].split('.')[1];
                    return min * 60 + sec + Math.round(ksec / 1000);
                  };
                  var lrcCont = lrctext.replace(/\[[A-Za-z]+:(.*?)]/g, '').replace('\\n', '').split(/[\]\[]/g),
                    lrcLine = '';
                  lrcTimeLine = [];
                  for (var i = 1; i < lrcCont.length; i += 2) {
                    var timer = formatTime(lrcCont[i]);
                    lrcTimeLine.push(timer);
                    if (i == 1) {
                      lrcLine += '<li class="wenkmLrc' + timer + ' current">' + lrcCont[i + 1] + '</li>'
                    } else {
                      lrcLine += '<li class="wenkmLrc' + timer + '">' + lrcCont[i + 1] + '</li>'
                    }
                  }
                  $('#wenkmLrc').html('<ul>' + lrcLine + '</ul>');
                  setTimeout(function () {
                    $('#wenkmLrc').addClass('show');
                  }, 500);
                  // console.log(typeNo);
                  if (typeNo == 1) {
                    lrcTime = setInterval(lrcCurrentAp1 , 500);
                  } else if (typeNo == 2) {
                    lrcTime = setInterval(lrcCurrentAp2 , 500);
                  } else if (typeNo == 3) {
                    lrcTime = setInterval(lrcCurrentAp3 , 500);
                  } else if (typeNo == 4) {
                    lrcTime = setInterval(lrcCurrentAp4 , 500);
                  }
                  
                }, 500);
              } else {
                songFrom44 = ' - 暂无歌词!', $songFrom3.html('<i class="fa fa-times-circle"></i> 暂无歌词');
                $(".switch-ksclrc").hide();
                $(".switch-down").css("right", "35px");
                $(".switch-default").css("right", "65px");
              }
            }
          }
        });
      }, 500);
    }

    // 获取当前路径图片颜色
    function colorChange(imgUrl) {
      $.ajax({
        url: 'https://free.limh.me/api/colorapi.php',
        type: 'GET',
        dataType: 'script',
        data: { url: imgUrl, userurl: location.hostname },
        success: function () {
          playercolor()
        },
        error: function () {
          var cont = '0,0,0';
          playercolor()
        }
      });
    }

    if (!isMobile()) {
      ap1.on('play', function () {
        if(audio){
          audio.pause();
        }
        var index1 = ap1.list.index;
        colorChange(aplist1[index1].cover);
        // 给歌词地址赋值
        lrcurl = aplist1[index1].lrc;
        lrcLoad(lrcurl, 1);
        wenkmTips.show('歌词加载中 - ' + aplist1[index1].artist + ' - ' + aplist1[index1].name);
      });

      ap2.on('play', function () {
        if(audio){
          audio.pause();
        }
        var index2 = ap2.list.index;
        colorChange(aplist2[index2].cover);
        // 给歌词地址赋值
        lrcurl = aplist2[index2].lrc;
        lrcLoad(lrcurl, 2);
        wenkmTips.show('歌词加载中 - ' + aplist2[index2].artist + ' - ' + aplist2[index2].name);
      });

      ap3.on('play', function () {
        if(audio){
          audio.pause();
        }
        var index3 = ap3.list.index;
        colorChange(aplist3[index3].cover);
        // 给歌词地址赋值
        lrcurl = aplist3[index3].lrc;
        lrcLoad(lrcurl, 3);
        wenkmTips.show('歌词加载中 - ' + aplist3[index3].artist + ' - ' + aplist3[index3].name);
      });

      ap4.on('play', function () {
        if(audio){
          audio.pause();
        }
        var index4 = ap4.list.index;
        colorChange(aplist4[index4].cover);
        // 给歌词地址赋值
        lrcurl = aplist4[index4].lrc;
        lrcLoad(lrcurl, 4);
        wenkmTips.show('歌词加载中 - ' + aplist4[index4].artist + ' - ' + aplist4[index4].name);
      });

      ap1.on('pause', function () {
        clearInterval(lrcTime);
				$('#wenkmLrc').removeClass('show');
        wenkmTips.show('暂停播放');
      });

      ap2.on('pause', function () {
        clearInterval(lrcTime);
				$('#wenkmLrc').removeClass('show');
        wenkmTips.show('暂停播放');
      });

      ap3.on('pause', function () {
        clearInterval(lrcTime);
				$('#wenkmLrc').removeClass('show');
        wenkmTips.show('暂停播放');
      });

      ap4.on('pause', function () {
        clearInterval(lrcTime);
				$('#wenkmLrc').removeClass('show');
        wenkmTips.show('暂停播放');
      });
    }

    var api = 'https://api.i-meto.com/api/v1/meting';
    var api2 = 'https://api.bzqll.com/music/netease/songList?key=579621905';

    function love() {
      document.getElementById('aplayerDiv1').style.display = 'inline';
      document.getElementById('aplayerDiv2').style.display = 'none';
      document.getElementById('aplayerDiv3').style.display = 'none';
      document.getElementById('aplayerDiv4').style.display = 'none';
      document.getElementById('text').innerHTML = "MyMusic";
    }

    // 初始化显示我的音乐列表
    love();
    
    function list() {
      document.getElementById('aplayerDiv1').style.display = 'none';
      document.getElementById('aplayerDiv2').style.display = 'inline';
      document.getElementById('aplayerDiv3').style.display = 'none';
      document.getElementById('aplayerDiv4').style.display = 'none';
      document.getElementById('text').innerHTML = "HotList";
      if (ap2.list.audios.length <= 0) {
        $.ajax({
          url: api + '?server=netease&type=playlist&id=3778678',
          success: function (list) {
            var array = JSON.parse(list);
            if (array.length > 0) {
              ap2.list.clear();
              ap2.list.add(array);
            } else {
              layer.msg('出现错误，请刷新页面');
            }
            aplist2 = array;
          }
        });
      }
    }

    function late() {
      document.getElementById('aplayerDiv1').style.display = 'none';
      document.getElementById('aplayerDiv2').style.display = 'none';
      document.getElementById('aplayerDiv3').style.display = 'inline';
      document.getElementById('aplayerDiv4').style.display = 'none';
      document.getElementById('text').innerHTML = "◢◤";
      if (ap3.list.audios.length <= 0) {
        $.ajax({
          url: api + '?server=netease&type=playlist&id=26462279',
          success: function (list) {
            var array = JSON.parse(list);
            if (array.length > 0) {
              ap3.list.clear();
              ap3.list.add(array);
            } else {
              layer.msg('出现错误，请刷新页面');
            }
            aplist3 = array;
          }
        });
      }
    }

    function now() {
      document.getElementById('aplayerDiv1').style.display = 'none';
      document.getElementById('aplayerDiv2').style.display = 'none';
      document.getElementById('aplayerDiv3').style.display = 'inline';
      document.getElementById('aplayerDiv4').style.display = 'none';
      document.getElementById('text').innerHTML = "NowList";
      $.ajax({
        url: api2 + '&id=26462279',
        success: function (data) {
          if (data.code == 200) {
            var array = data.data.songs;
            for (var i = 0, len = data.data.songs.length; i < len; i++) {
              array[i].id = array[i].id;
              array[i].name = array[i].name;
              array[i].artist = array[i].singer;
              array[i].cover = array[i].pic;
              array[i].lrc = array[i].lrc;
            }
            ap3.list.clear();
            ap3.list.add(array);
            aplist3 = array;
          } else {
            layer.msg('出现错误，请刷新页面');
          }
        }
      });
    }

    function search(btn) {
      // 开始执行，先将按钮置为不可用，执行完后设置可用
      btn.disabled = true;
      var serachType = document.getElementById("serachType").value;
      var serachText = document.getElementById("serachText").value;
      if (serachText.trim() === '') {
        layer.msg('关键字为空');
        btn.disabled = false;
        return;
      }
      var url = api + '?type=search&server=' + serachType + '&id=' + serachText;
      $.ajax({
        url: url,
        success: function (list) {
          var array = JSON.parse(list);
          console.log(url);
          console.log(array);
          if (array.length > 0) {
            document.getElementById('aplayerDiv1').style.display = 'none';
            document.getElementById('aplayerDiv2').style.display = 'none';
            document.getElementById('aplayerDiv3').style.display = 'none';
            document.getElementById('aplayerDiv4').style.display = 'inline';
            document.getElementById('text').innerHTML = "Search";
            ap4.list.clear();
            ap4.list.add(array);
          } else {
            layer.msg('没有搜索到任何结果，请切换平台尝试');
          }
          aplist4 = array;
          btn.disabled = false;
        }
      });
    }

    // 文字特效
    var colors = ['#FF1177', '#228DFF', '#FFDD1B', '#B6FF00', '#FF9900', '#BA01FF'];
    var fonts = ['Pacifico', 'Audiowide', 'Vampiro One'];
    var text = document.getElementById("text");
    // 推荐使用setTimeout
    setTimeout(function () {
      text.style.color = colors[Math.floor(colors.length * Math.random())];
      text.style.fontFamily = fonts[Math.floor(fonts.length * Math.random())];
      setTimeout(arguments.callee, 1000);
    }, 1000);
  </script>
  <!-- 页面点击小红心 -->
  <script type="text/javascript" src="https://wang926454.gitee.io/reader/JS/love.js"></script>
  <script type="text/javascript" src="https://wang64.cn/static/count.js"></script>
</body>

</html>
